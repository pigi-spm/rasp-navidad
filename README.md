# Rasp-navidad

<img src="./img/santa-claus-banner.png" style="display:block;margin-left: auto;margin-right: auto;"/>  

#

[<img src="./img/rasp navidad by pigi-spm - YouTube.png" style="display:block;margin-left: auto;margin-right: auto;width: 100%;" width="100%">](https://youtu.be/ApEIubyJYlE)


## What is rasp-navidad?

_Rasp-navidad_ is a project made to animate your crib or your Santa Claus village with light effects to the rhythm of music, instead of the usual boring fixed lights.  
The code is ready to use, just download, install and configure it :)

## what you need?
<table>
    <tbody>
        <tr>
            <td>
                <a href ="https://www.amazon.com/s?k=raspberry&__mk_de_DE=%C3%85M%C3%85%C5%BD%C3%95%C3%91&ref=nb_sb_noss_1">Raspberry</a> 
            </td>
            <td> 
                <img src="https://www.critics-corporation.com/RaspberryPi/wp-content/uploads/2019/05/14643-Raspberry_Pi_3_B_-02.jpg" width="30%"/>
            </td>
        </tr>
        <tr>
           <td>
                <a href ="https://www.amazon.com/s?k=relay+4-channel+raspberry+pi&ref=nb_sb_noss_2">relay 4-channel raspberry pi</a> 
            </td>
            <td> 
                <img src="https://potentiallabs.com/cart/image/cache/catalog/Arduino/4-channel%20relay%20Module-800x800.jpg" width="30%"> (min. 3-channel)
            </td>
        </tr>
        <tr>
           <td>
                <a href ="https://www.amazon.com/s?k=3-way+audio+filter&ref=nb_sb_noss_2">3-way audio filter pi</a> 
            </td>
            <td> 
                <img src="https://i.pinimg.com/originals/d2/51/52/d251526d83bab3cbd5f0eb2cdf51dc98.jpg" width="30%"> (I used only one way to get the white color) (<b>Optional</b>)
            </td>
        </tr>
        <tr>
           <td>
                <a href ="https://www.amazon.com/econoLED-Flexible-Multi-colors-Non-waterproof-Changing/dp/B006LW2NJM/ref=sr_1_8?dchild=1&keywords=rgb+led+strip+lights+12v&qid=1606498228&sr=8-8">rgb led strip lights 12v</a> 
            </td>
            <td> 
                <img src="https://www.hiline-lighting.co.uk/2752-large_default/rgb-led-streifen-12v-ip00-smd5050.jpg" width="30%"> (led strip with 12V and 4 pins)
            </td>
        </tr>
        <tr>
           <td>
                <a href ="https://www.amazon.com/AmazonBasics-Stereo-Audio-Cable-Meters/dp/B00NO73Q84/ref=sr_1_3?__mk_de_DE=%C3%85M%C3%85%C5%BD%C3%95%C3%91&dchild=1&keywords=3.5mm+cable&qid=1606499579&sr=8-3">3.5 mm Male to Male Stereo Audio Cable</a> 
            </td>
            <td> 
                <img src="https://www.nierle.com/pic/978239a.jpg" width="30%"> 
            </td>
        </tr>
        <tr>
            <td>
                <a href ="https://images-na.ssl-images-amazon.com/images/I/71OgoJjpvDL._AC_SL1500_.jpg">radio with aux input and one output for the speackers</a> 
            </td>
            <td> 
                <img src="https://images-na.ssl-images-amazon.com/images/I/71OgoJjpvDL._AC_SL1500_.jpg" width="30%"> 
            </td>
        </tr>
        <tr>
            <td>
                <a href ="https://www.ebay.com/sch/i.html?_from=R40&_trksid=p2334524.m570.l1313&_nkw=IRLZ34+N-Channel+MOSFET&_sacat=0">IRLZ34 N-Channel MOSFET</a> 
            </td>
            <td> 
                <img src="https://i.ebayimg.com/images/g/8U8AAOSwHiBe5hA9/s-l1600.jpg" width="30%"> 
            </td>
        </tr>
        <tr>
            <td>
                <a href ="https://www.amazon.com/Breadboard-for-the-Raspberry-Pi/dp/B00GHNJIZC">Breadboard for the Raspberry Pi</a> 
            </td>
            <td> 
                <img src="https://images-na.ssl-images-amazon.com/images/I/411yd4hnbvL._AC_.jpg" width="30%"> 
            </td>
        </tr>
        <tr>
            <td>
                <a href ="https://www.amazon.com/DEVMO-Multicolored-Arduino-Breadboard-Raspberry/dp/B07TSRHNDH/ref=sr_1_10?crid=1XORB21BT66SN&dchild=1&keywords=raspberry+pi+gpio+male+to+female+cable&qid=1606500805&sprefix=raspberry+pi+cable+male%2Caps%2C314&sr=8-10">raspberry pi gpio male to female jumper</a> 
            </td>
            <td> 
                <img src="https://images-na.ssl-images-amazon.com/images/I/71L3ytLKIGL._AC_SL1500_.jpg" width="30%"> 
            </td>
        </tr>
        <tr>
            <td>
                <a href ="https://www.amazon.com/Breadboard-20-More-Red-Black-Jumpers-120-Pack-Hellotronics/dp/B07XMG9LSZ/ref=sr_1_1_sspa?dchild=1&keywords=raspberry+pi+gpio+male+to+male+jumper&qid=1606500893&sr=8-1-spons&psc=1&spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEyQ1YyOTE2SDRBR1ZVJmVuY3J5cHRlZElkPUEwNzA4MTAzMjhRM0tWUjZMWlZVUCZlbmNyeXB0ZWRBZElkPUEwNTkzODgyWDVDQkIyNDRGSzI3JndpZGdldE5hbWU9c3BfYXRmJmFjdGlvbj1jbGlja1JlZGlyZWN0JmRvTm90TG9nQ2xpY2s9dHJ1ZQ==">raspberry pi gpio male to male jumper</a> 
            </td>
            <td> 
                <img src="https://images-na.ssl-images-amazon.com/images/I/71njUOK2boL._AC_SL1220_.jpg" width="30%"> 
            </td>
        </tr>
        <tr>
            <td>
                <a href ="https://www.amazon.com/LEDMO-12V-Power-Supply-Transformers/dp/B06Y64QLBM/ref=sr_1_10?dchild=1&keywords=Transformer+12v&qid=1606501227&sr=8-10">Power Supply Adapter Power Adapter AC 100-240V to DC 12V with Plug Power Converter Power Supply LED Driver</a> 
            </td>
            <td> 
                <img src="https://images-na.ssl-images-amazon.com/images/I/613womBo0oL._AC_SL1000_.jpg" width="30%"> 
            </td>
        </tr>
    </tbody>
</table>

#

## How to connect everything

We have designed the scheme that needs to be replicated, to make it work properly:

Scheme with audio filter. With it you can control each led from the led strips, so you get a more colorful effect.

![rasp-navidad_with_audio_filter](/scheme/rasp-navidad_with_audio_filter.jpg)

With this scheme all the colors of the LED are combined. The color you get is only white.

![rasp-navidad_without_audio_filter](/scheme/rasp-navidad_without_audio_filter.jpg)

#

## Which operating system should I use?

I used the Raspberry Pi OS Lite with version 10.6, but the script should work with all Linux operating systems (It has not been tested with the various operating systems).

## Installation

You must download the project in your raspberry. One possible way is to use the git to clone it in the raspberry.

_Git installation_: You must have installed the git on your raspberry to clone the repository. If you have not installed it, please run the follow command:

```
apt-get update & apt-get install git
```

After the installation, you can clone the repository in your raspberry. To make it, please show this doc:
* https://docs.github.com/en/free-pro-team@latest/github/creating-cloning-and-archiving-repositories/cloning-a-repository

After the cloning the project, you can install the rasp-navidad.
In the folder you find the file ``` install.sh ```, with it you can install the script simply by starting the installation process.  
Please run the follow command:
```
sudo ./install.sh
```

**If you can not start the file, please check if you have the permissions to execute the file.**

After installation you can verify that the script has been installed by checking in location:
```
/usr/script/rasp-navidad
```

In this position you need to modify the config.py file to set the GPIO pins that will be used.
What you must change in the file:

```
pid = dict(
    blue=<pin number>,
    red=<pin number>,
    green=<pin number>,
)
```
It corresponds to the connection between the raspberry and the relay for direct control of the led strips.
![rasp-navidad_without_audio_filter](/scheme/rasp_navidad_pid.png)

```
relay = dict(
    blue=<pin number>,
    red=<pin number>,
    green=<pin number>,
)
```
It corresponds to the connection between the rasbperry and the relay for relay control.
![rasp-navidad_without_audio_filter](/scheme/rasp_navidad_relay.png)

## _The package already contains some test songs inside_

# How you can load the music in the script

In the main folder (default ```/usr/script/rasp-navidad/```) there is the ```'audio'``` folder. In this location you can insert the ```mp3``` files, that you wish use.

The audio files can be set differently:
![rasp-navidad_without_audio_filter](/img/selectMusic.png)

- <span style="color:yellow">yellow</span>: This files are used with the random function. if you set a number at the beginning of the file name, it will be embedded in the list of random music files. The format is **[number]_name_of_the_file.mp3**
- <span style="color:blue">blue</span>: You want to select the file you want to use each time you start the script. Simply enter the number of the file name
- <span style="color:red">red</span>: You can exclude the file from the list of random music files, and it can be used directly by entering the file name
- <span style="color:white">white</span>: You can exclude the file from the list of random music files, and it can be used directly by entering the file name. If you use the function **lightsEffectWithGPIO**, you have to insert the color of the pins you want to use, inserting them in an array.
- <span style="color:orange">orange</span>: You can exclude the file from the list of random music files, and it can be used directly by entering the file name. If you use the function **lightsEffectWithoutGPIO**, you do not have to enter any color pins.

_You can insert as many songs as you want, but you must remember to edit the code in the ```main.py``` file_

# What to change in the code in the main.py file

The following items need to be modified:  
- Change the _effectSelector_ function in the main.py file by entering for each if:
   * **onRelay([relayBlue, relayRed, relayGreen]):**
     * Insert in the array the relays you want to activate
     * ```onRelay``` is always in combination with ```lightsEffectWithGPIO```
   * **lightsEffectWithGPIO("[filename]"/str(self.utils.setRandomRange())/str([int]), [ledRed, ledBlue, ledGreen])**
     * You can insert in the array the leds you want to activate/use to make the sunrise and sunset effect.
   * **offRelay([relayBlue, relayRed, relayGreen])**
     * Insert in the array the relays you want to deactivate
     * ```offRelay``` is always in combination with ```lightsEffectWithoutGPIO```
   * **lightsEffectWithoutGPIO("[filename]"/str(self.utils.setRandomRange())/str([int]))**
     * Do not insert the LEDs, because they will be activated to the rhythm of the music.

```The script is ready to be used.```

# Automatic start with cronjob

Two cronjobs were installed in the crontab to activate and use the script, as well as to automatically remove the log files after 7 days. It can be modified at any time by opening the crontab with: 

```crontab -e```

# Log files

A log file is created. You can find it in:  
```/var/log/rasp-navidad-logs/rasp-navidad_yyyymmdd.log```

## LICENSE

Creative Commons Attribution 3.0 International License (CC BY 3.0)

https://creativecommons.org/licenses/by/3.0/

## _Enjoy your life and stay healthy_

## _We wish you a Merry Christmas and a Happy New Year._